import{_ as t,a as e}from"./index-D0leoF_v.js";import{r as a,i as l,o as i,q as s,c as n,a as o,b as r,h as c,t as u,u as d,g as m,w as p,n as g,F as v,e as b,s as j}from"./vendor-B7hMTXyf.js";import{L as y}from"./map-CAoF2if5.js";import"./ui-BrD-T1AS.js";const f=""+new URL("rcld0km-TScCjsmx.jpg",import.meta.url).href,k=Object.freeze(Object.defineProperty({__proto__:null,default:f},Symbol.toStringTag,{value:"Module"})),h={Badge:"已经标记了哪些骑迹？",Title:"骑行友好 Life 地图"},x={class:"jn-map mt-5 position-relative",id:"Map"},w={class:"badge bg-dark jn-badge"},_={class:"row justify-content-evenly mt-5 mx-0"},L={key:0,class:"px-5 col-12"},T={key:0,class:"jn-h2"},O=["innerHTML"],C={key:1,class:"jn-right-panel col-md-7 col-12"},M={class:"jn-modal-content"},E={class:"jn-modal-header"},S={key:0,class:"bi bi-arrow-up-right-circle ms-2 text-success"},z={class:"jn-modal-body"},F={key:0,class:"mb-3"},$=["src","alt"],B=["innerHTML"],H={key:1,class:"mt-3 mb-3"},I=t({__name:"Map",setup(t){const f=a(!1),I=a(null),P=a(!1),A=l({title:"",description:"",image:"",tags:[],url:""}),X=()=>{P.value=!1,document.removeEventListener("keydown",G)},G=t=>{"Escape"===t.key&&X()},N=a(""),R=t=>t.toString().replace(/<li>/g,'<p><i class="bi bi-geo-alt-fill text-success"></i> ').replace(/<\/li>/g,"</p>").replace(/<ul>/g,"").replace(/<\/ul>/g,"");N.value=R('<p>这里标记了一些重要的地点，每个地点都有特殊的意义。点击地图上的标记可以查看详细信息。此处还在不断迭代升级 ING，欢迎<a href="https://XXX">点击</a>一起标记：</p>\n<ul>\n<li>骑行友好商店/空间/补给点</li>\n<li>骑行友好绿道/秘境</li>\n<li>你觉得值得标记的地方</li>\n</ul>\n');const V=Object.assign({"/contents/maps/tflvdao.md":()=>e(()=>import("./tflvdao-NuoAQm4l.js"),[],import.meta.url)}),q=Object.assign({"/contents/maps/images/rcld0km.jpg":k}),D=l([]),U=async()=>{await j(),I.value=y.map("mapContainer").setView([39.9042,116.4074],2),y.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(I.value);const t=y.divIcon({className:"custom-marker",html:'<i class="bi bi-geo-alt-fill text-success" style="font-size: 24px; cursor: pointer;"></i>',iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-30]});I.value.on("click",function(t){const e=t.latlng.lat.toFixed(6),a=t.latlng.lng.toFixed(6);y.popup().setLatLng([e,a]).setContent(`<div style="text-align: center;">\n            <strong>📍 获取的坐标</strong><br>\n            <small>纬度: ${e}</small><br>\n            <small>经度: ${a}</small><br>\n            <button onclick="navigator.clipboard.writeText('latitude: ${e}\\nlongitude: ${a}')" \n        style="margin-top: 8px; padding: 4px 8px; font-size: 12px;">复制坐标</button>\n        </div>`).openOn(I.value)}),D.forEach((e,a)=>{const l=e.attributes;if(l.latitude&&l.longitude){const a=y.marker([parseFloat(l.latitude),parseFloat(l.longitude)],{icon:t,title:l.title||"点击查看详情"}).addTo(I.value);a.bindPopup(`<b>${l.title||"未知位置"}</b><br>点击标记查看详情`),a.on("click",t=>{var a;a={title:l.title,description:e.html,image:l.image,tags:l.tags,url:l.url},A.title=a.title||"未知位置",A.description=a.description||"",A.image=a.image||"",A.tags=a.tags||[],A.url=a.url||"",P.value=!0,document.addEventListener("keydown",G)})}});const e=D.filter(t=>t.attributes.latitude&&t.attributes.longitude);if(e.length>0){const t=new y.featureGroup(e.map(t=>y.marker([t.attributes.latitude,t.attributes.longitude])));I.value.fitBounds(t.getBounds().pad(.1))}};return i(async()=>{try{await(async()=>{const t=Object.values(V).map(async t=>{const e=await t(),a=e.attributes,l=Object.keys(q).find(t=>t.includes(a.image)),i=l?q[l].default:null;return{html:R(e.html),attributes:{...a,image:i}}});D.push(...await Promise.all(t)),D.sort((t,e)=>t.attributes.date-e.attributes.date),f.value=!0})(),await U()}catch(t){}}),s(()=>{document.removeEventListener("keydown",G),I.value&&I.value.remove()}),(t,e)=>(o(),n("div",x,[r("span",w,[e[2]||(e[2]=r("i",{class:"bi bi-bullseye"},null,-1)),c(" "+u(d(h).Badge),1)]),r("div",_,[f.value?(o(),n("div",L,[d(h).Title?(o(),n("h2",T,u(d(h).Title),1)):m("",!0),r("div",{innerHTML:N.value},null,8,O),e[4]||(e[4]=r("div",{class:"jn-map-container"},[r("div",{id:"mapContainer",class:"jn-leaflet-map"})],-1)),f.value?(o(),n("div",C)):m("",!0),P.value?(o(),n("div",{key:2,class:"jn-modal-overlay",onClick:X},[r("div",{class:"jn-modal-container",onClick:e[1]||(e[1]=p(()=>{},["stop"]))},[r("div",M,[r("div",E,[r("h5",{class:g(["jn-modal-title",{"jn-modal-title-link":A.url}]),onClick:e[0]||(e[0]=t=>{return A.url&&void((e=A.url)&&window.open(e,"_blank","noopener,noreferrer"));var e})},[c(u(A.title)+" ",1),A.url?(o(),n("i",S)):m("",!0)],2),r("button",{type:"button",class:"jn-modal-close",onClick:X,"aria-label":"关闭详情窗口"},e[3]||(e[3]=[r("i",{class:"bi bi-x-lg"},null,-1)]))]),r("div",z,[A.image?(o(),n("div",F,[r("img",{src:A.image,alt:A.title,class:"img-fluid rounded"},null,8,$)])):m("",!0),r("div",{innerHTML:A.description,class:"jn-modal-content"},null,8,B),A.tags?(o(),n("div",H,[(o(!0),n(v,null,b(A.tags,t=>(o(),n("span",{key:t,class:"badge bg-success jn-tags me-2"},u(t),1))),128))])):m("",!0)])])])])):m("",!0)])):m("",!0)])]))}},[["__scopeId","data-v-4eacaa21"]]);export{I as default};
